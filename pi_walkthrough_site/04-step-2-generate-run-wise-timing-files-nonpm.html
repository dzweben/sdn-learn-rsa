<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Step 2 – Generate run-wise timing files (NonPM) – LEARN RSA PI Walkthrough</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div class="layout">
    <nav class="sidebar">
      <div class="site-title">LEARN RSA PI Walkthrough</div>
      <ul class="nav">
  <li class=""><a href="index.html">Overview</a></li>
  <li class=""><a href="02-step-0-map-of-paths-and-environment.html">Step 0 – Map of Paths and Environment</a></li>
  <li class=""><a href="03-step-1-fix-events-nopred-fdbk-relabel.html">Step 1 – Fix events (nopred_fdbk relabel)</a></li>
  <li class="active"><a href="04-step-2-generate-run-wise-timing-files-nonpm.html">Step 2 – Generate run-wise timing files (NonPM)</a></li>
  <li class=""><a href="05-step-3-generate-afni-proc-scripts-no-blur-from-raw-bids.html">Step 3 – Generate AFNI proc scripts (no blur) from raw BIDS</a></li>
  <li class=""><a href="06-step-4-run-availability-audit-raw-bids.html">Step 4 – Run availability audit (raw BIDS)</a></li>
  <li class=""><a href="07-step-5-run-the-full-afni-pipeline-proc-glm-in-tmux.html">Step 5 – Run the full AFNI pipeline (proc + GLM) in tmux</a></li>
  <li class=""><a href="08-step-6-audit-post-run-checks.html">Step 6 – Audit (post-run checks)</a></li>
  <li class=""><a href="09-setback-b-sub-1522-glm-collinearity.html">Setback B – sub-1522 GLM collinearity</a></li>
</ul>
    </nav>
    <main class="content">
      <article>
        <h2 id="step-2-generate-run-wise-timing-files-nonpm">Step 2 – Generate run-wise timing files (NonPM)</h2>
<p>Purpose: convert corrected events into run-wise <code>NonPM_*_runX.1D</code> timing files and prediction/response timing files.</p>
<p>Important detail: the server copy of the timing script was hard-coded to <code>bids</code> and <code>TimingFiles/Full</code>. We patched a temporary copy to point at <code>bids_fixed2</code> and <code>TimingFiles/Fixed2</code>.</p>
<p>Command used (temp patch + run):</p>
<pre><code class="language-bash">TMP=/tmp/LEARN_1D_AFNItiming_Full_RSA_runwise_fixed2.sh
cp /data/projects/STUDIES/LEARN/fMRI/RSA-learn/scripts/LEARN_1D_AFNItiming_Full_RSA_runwise.sh &quot;$TMP&quot;
sed -i 's|BIDS_DIR=&quot;[^&quot;]*&quot;|BIDS_DIR=&quot;/data/projects/STUDIES/LEARN/fMRI/RSA-learn/bids_fixed2&quot;|' &quot;$TMP&quot;
sed -i 's|TIMING_ROOT=&quot;[^&quot;]*&quot;|TIMING_ROOT=&quot;/data/projects/STUDIES/LEARN/fMRI/RSA-learn/TimingFiles/Fixed2&quot;|' &quot;$TMP&quot;
bash &quot;$TMP&quot;
</code></pre>
<p>Script (full): <code>rsa-learn/scripts/LEARN_1D_AFNItiming_Full_RSA_runwise.sh</code></p>
<pre><code class="language-bash">#!/bin/bash

#######################################################
# SCRIPT SUMMARY
#######################################################
# RSA‑learn RUN‑WISE timing generator (NonPM only)
#
# This script is intentionally derived from:
#   /data/projects/STUDIES/LEARN/fMRI/code/afni/LEARN_1D_AFNItiming_Full.sh
#
# Key goal:
#   Create NON‑PARAMETRIC (onset:duration only) timing files
#   for each run and each peer×feedback condition so we can
#   estimate RUN‑WISE betas in AFNI.
#
# IMPORTANT: This script is *not* replacing the existing pipeline.
# It is a parallel RSA‑learn pipeline that matches the original
# naming conventions and event logic, but outputs run‑wise files.
#
# Author: RSA‑learn adaptation (based on Tessa Clarkson script)
# Date: 2026‑02‑08

############################################################################################
# GENERAL SETUP
############################################################################################

# **CHANGE ME**: Subject list file (one ID per line, no &quot;sub-&quot;)
SUBJ_LIST=&quot;${SUBJ_LIST_OVERRIDE:-/data/projects/STUDIES/LEARN/fMRI/code/afni/subjList_LEARN.txt}&quot;

# **CHECK ME**: Root directories
TOPDIR=&quot;/data/projects/STUDIES/LEARN/fMRI&quot;
BIDS_DIR=&quot;${BIDS_DIR_OVERRIDE:-$TOPDIR/bids}&quot;

# **RSA‑learn output root (new)**
TIMING_ROOT=&quot;${TIMING_ROOT_OVERRIDE:-$TOPDIR/RSA-learn/TimingFiles/Full}&quot;

############################################################################################
# COPY EVENTS + BUILD NON‑PARAMETRIC RUN‑WISE TIMING FILES
############################################################################################

# For each subject...
for subj in `cat ${SUBJ_LIST}`; do
    echo &quot;[RSA‑learn] Generating NonPM run‑wise timing files for sub-${subj}&quot;

    # Create output folder (keep RSA‑learn timing separate)
    mkdir -p &quot;${TIMING_ROOT}/sub-${subj}&quot;

    # Clean any old event files so we know these are current
    rm -f &quot;${TIMING_ROOT}/sub-${subj}/sub-${subj}_task-learn_run-0&quot;*_events.tsv

    # Copy BIDS events into RSA‑learn timing folder (so everything is self‑contained)
    cp &quot;${BIDS_DIR}/sub-${subj}/func/sub-${subj}_task-learn_run-01_events.tsv&quot; &quot;${TIMING_ROOT}/sub-${subj}/&quot;
    cp &quot;${BIDS_DIR}/sub-${subj}/func/sub-${subj}_task-learn_run-02_events.tsv&quot; &quot;${TIMING_ROOT}/sub-${subj}/&quot;
    cp &quot;${BIDS_DIR}/sub-${subj}/func/sub-${subj}_task-learn_run-03_events.tsv&quot; &quot;${TIMING_ROOT}/sub-${subj}/&quot;
    cp &quot;${BIDS_DIR}/sub-${subj}/func/sub-${subj}_task-learn_run-04_events.tsv&quot; &quot;${TIMING_ROOT}/sub-${subj}/&quot;

    # Move into subject timing folder
    cd &quot;${TIMING_ROOT}/sub-${subj}/&quot;

    ############################################################
    # NOTE ON NAMING
    ############################################################
    # Event names in events.tsv use:
    #   Mean_60_* and Nice_60_*   (underscore)
    #   Mean80_*  and Nice80_*    (no underscore)
    # We preserve the existing naming convention for files:
    #   Mean60_*, Mean80_*, Nice60_*, Nice80_*
    ############################################################

    ############################################################
    # NON‑PARAMETRIC FEEDBACK (peer × feedback) — RUN‑WISE
    ############################################################

    # Mean_60 feedback
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkm_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkm_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkm_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkm_run4.1D
    rm -f NonPM_Mean60_fdkm.1D
    for f in NonPM_Mean60_fdkm_run1.1D NonPM_Mean60_fdkm_run2.1D NonPM_Mean60_fdkm_run3.1D NonPM_Mean60_fdkm_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Mean60_fdkm.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkn_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkn_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkn_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean60_fdkn_run4.1D
    rm -f NonPM_Mean60_fdkn.1D
    for f in NonPM_Mean60_fdkn_run1.1D NonPM_Mean60_fdkn_run2.1D NonPM_Mean60_fdkn_run3.1D NonPM_Mean60_fdkn_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Mean60_fdkn.1D; done

    # Mean80 feedback
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkm_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkm_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkm_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkm_run4.1D
    rm -f NonPM_Mean80_fdkm.1D
    for f in NonPM_Mean80_fdkm_run1.1D NonPM_Mean80_fdkm_run2.1D NonPM_Mean80_fdkm_run3.1D NonPM_Mean80_fdkm_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Mean80_fdkm.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkn_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkn_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkn_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Mean80_fdkn_run4.1D
    rm -f NonPM_Mean80_fdkn.1D
    for f in NonPM_Mean80_fdkn_run1.1D NonPM_Mean80_fdkn_run2.1D NonPM_Mean80_fdkn_run3.1D NonPM_Mean80_fdkn_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Mean80_fdkn.1D; done

    # Nice_60 feedback
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkm_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkm_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkm_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice_60_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkm_run4.1D
    rm -f NonPM_Nice60_fdkm.1D
    for f in NonPM_Nice60_fdkm_run1.1D NonPM_Nice60_fdkm_run2.1D NonPM_Nice60_fdkm_run3.1D NonPM_Nice60_fdkm_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Nice60_fdkm.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkn_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkn_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkn_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice_60_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice60_fdkn_run4.1D
    rm -f NonPM_Nice60_fdkn.1D
    for f in NonPM_Nice60_fdkn_run1.1D NonPM_Nice60_fdkn_run2.1D NonPM_Nice60_fdkn_run3.1D NonPM_Nice60_fdkn_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Nice60_fdkn.1D; done

    # Nice80 feedback
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkm_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkm_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkm_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice80_fdkm&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkm_run4.1D
    rm -f NonPM_Nice80_fdkm.1D
    for f in NonPM_Nice80_fdkm_run1.1D NonPM_Nice80_fdkm_run2.1D NonPM_Nice80_fdkm_run3.1D NonPM_Nice80_fdkm_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Nice80_fdkm.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkn_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkn_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkn_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice80_fdkn&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; NonPM_Nice80_fdkn_run4.1D
    rm -f NonPM_Nice80_fdkn.1D
    for f in NonPM_Nice80_fdkn_run1.1D NonPM_Nice80_fdkn_run2.1D NonPM_Nice80_fdkn_run3.1D NonPM_Nice80_fdkn_run4.1D; do (cat $f; echo '') &gt;&gt; NonPM_Nice80_fdkn.1D; done

    ############################################################
    # NON‑PARAMETRIC PREDICTION + RESPONSE (RUN‑WISE)
    ############################################################

    # Mean_60 prediction/response
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_pred_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_pred_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_pred_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_pred_run4.1D
    rm -f Mean60_pred.1D
    for f in Mean60_pred_run1.1D Mean60_pred_run2.1D Mean60_pred_run3.1D Mean60_pred_run4.1D; do (cat $f; echo '') &gt;&gt; Mean60_pred.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_rsp_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_rsp_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_rsp_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean60_rsp_run4.1D
    rm -f Mean60_rsp.1D
    for f in Mean60_rsp_run1.1D Mean60_rsp_run2.1D Mean60_rsp_run3.1D Mean60_rsp_run4.1D; do (cat $f; echo '') &gt;&gt; Mean60_rsp.1D; done

    # Mean80 prediction/response
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_pred_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_pred_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_pred_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_pred_run4.1D
    rm -f Mean80_pred.1D
    for f in Mean80_pred_run1.1D Mean80_pred_run2.1D Mean80_pred_run3.1D Mean80_pred_run4.1D; do (cat $f; echo '') &gt;&gt; Mean80_pred.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Mean80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_rsp_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Mean80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_rsp_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Mean80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_rsp_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Mean80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Mean80_rsp_run4.1D
    rm -f Mean80_rsp.1D
    for f in Mean80_rsp_run1.1D Mean80_rsp_run2.1D Mean80_rsp_run3.1D Mean80_rsp_run4.1D; do (cat $f; echo '') &gt;&gt; Mean80_rsp.1D; done

    # Nice_60 prediction/response
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_pred_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_pred_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_pred_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice_60_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_pred_run4.1D
    rm -f Nice60_pred.1D
    for f in Nice60_pred_run1.1D Nice60_pred_run2.1D Nice60_pred_run3.1D Nice60_pred_run4.1D; do (cat $f; echo '') &gt;&gt; Nice60_pred.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_rsp_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_rsp_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_rsp_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice_60_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice60_rsp_run4.1D
    rm -f Nice60_rsp.1D
    for f in Nice60_rsp_run1.1D Nice60_rsp_run2.1D Nice60_rsp_run3.1D Nice60_rsp_run4.1D; do (cat $f; echo '') &gt;&gt; Nice60_rsp.1D; done

    # Nice80 prediction/response
    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_pred_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_pred_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_pred_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice80_pred&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_pred_run4.1D
    rm -f Nice80_pred.1D
    for f in Nice80_pred_run1.1D Nice80_pred_run2.1D Nice80_pred_run3.1D Nice80_pred_run4.1D; do (cat $f; echo '') &gt;&gt; Nice80_pred.1D; done

    cat sub-${subj}_task-learn_run-01_events.tsv | awk '{if ($3==&quot;Nice80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_rsp_run1.1D
    cat sub-${subj}_task-learn_run-02_events.tsv | awk '{if ($3==&quot;Nice80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_rsp_run2.1D
    cat sub-${subj}_task-learn_run-03_events.tsv | awk '{if ($3==&quot;Nice80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_rsp_run3.1D
    cat sub-${subj}_task-learn_run-04_events.tsv | awk '{if ($3==&quot;Nice80_rsp&quot;) {printf &quot;%s:%s &quot;, $1, $2}}' &gt; Nice80_rsp_run4.1D
    rm -f Nice80_rsp.1D
    for f in Nice80_rsp_run1.1D Nice80_rsp_run2.1D Nice80_rsp_run3.1D Nice80_rsp_run4.1D; do (cat $f; echo '') &gt;&gt; Nice80_rsp.1D; done


    ############################################################
    # PAD RUN‑WISE NonPM FILES TO 4 ROWS (AFNI MULTI‑RUN)
    ############################################################
    # AFNI expects one row per run for multi‑run datasets.
    # Each run‑wise file currently has 1 row. Pad to 4 rows
    # using '*' for non‑target runs.

    for f in NonPM_*_run*.1D; do
        run=$(echo &quot;$f&quot; | sed -E 's/.*_run([1-4])\.1D/\1/')
        line=$(tr -d '
' &lt; &quot;$f&quot;)
        if [ -z &quot;$line&quot; ]; then
            line=&quot;*&quot;
        fi
        case &quot;$run&quot; in
            1) printf &quot;%s
*
*
*
&quot; &quot;$line&quot; &gt; &quot;$f&quot; ;;
            2) printf &quot;*
%s
*
*
&quot; &quot;$line&quot; &gt; &quot;$f&quot; ;;
            3) printf &quot;*
*
%s
*
&quot; &quot;$line&quot; &gt; &quot;$f&quot; ;;
            4) printf &quot;*
*
*
%s
&quot; &quot;$line&quot; &gt; &quot;$f&quot; ;;
        esac
    done

done

</code></pre>
<p>Source script (lab original): <code>/data/projects/STUDIES/LEARN/fMRI/code/afni/LEARN_1D_AFNItiming_Full.sh</code></p>
<p>The RSA timing script above is a run‑wise adaptation of this lab script. The original script is not reproduced here verbatim to avoid redundancy, but the full source is available at the path above.</p>
<p>Output example:</p>
<p>Example (run‑wise files for one condition; note <code>*</code> fillers for non‑target runs):</p>
<table>
<thead>
<tr>
<th>Run 1 file</th>
<th>Run 2 file</th>
<th>Run 3 file</th>
<th>Run 4 file</th>
</tr>
</thead>
<tbody>
<tr>
<td>217.826:3 <br><code>*</code><br><code>*</code><br><code>*</code></td>
<td><code>*</code><br>32.757:3 356.689:3 <br><code>*</code><br><code>*</code></td>
<td><code>*</code><br><code>*</code><br>217.827:3 <br><code>*</code></td>
<td><code>*</code><br><code>*</code><br><code>*</code><br>125.305:3 310.371:3</td>
</tr>
</tbody>
</table>
<p>This shows how each run‑specific file contains timing only for its run, with <code>*</code> in the other three rows.</p>
<ul>
<li><code>/data/projects/STUDIES/LEARN/fMRI/RSA-learn/TimingFiles/Fixed2/sub-1522/NonPM_Mean80_fdkn_run1.1D</code></li>
</ul>
      </article>
      <div class="footer">Generated 2026-02-18 17:04
      </div>
    </main>
  </div>
</body>
</html>
